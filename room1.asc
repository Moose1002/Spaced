// room script file

function room_Load()
{
  if (OpeningStuck) { player.LockView(2, eStopMoving); }
  if (DoorRepaired) { oDoorControl.Graphic = 19; }
}

function oObject0_Look(Object *theObject, CursorMode mode)
{
  Display("I am not going back under there!");
}

function room_AfterFadeIn()
{
  
}

function room_FirstLoad()
{
  RemoveWalkableArea(1);
  dOpening.Start();
  player.ChangeRoom(2);
}
function room_RepExec()
{
  /*
  if (!IndependentShadow) 
  {
    cShadow.x = cArin.x + 10;
    cShadow.y = cArin.y + 5;
  }
  */
  if (OpeningStuck) {
    if (player.ScriptName == "cArin") {
      RemoveWalkableArea(1);
    }
    else
    {
      RestoreWalkableArea(1);
    }
  }
  
  /*
  float t = 0.0;
  while (t <= 1.0) {
    int redTint = TweenMaths.Lerp(0.0, 100.0, t);
    TintScreen(redTint, 100, 100);
    Wait(1);
    t = t + 0.01;
  }
  */
}

function oScrewdriver_PickUp(Object *theObject, CursorMode mode)
{
  
}

function oScrewdriver_Interact(Object *theObject, CursorMode mode)
{
  if (OpeningStuck) 
  {
    cArin.Say("I can't reach it!");
    return; 
  }
  AddInventoryHelper(theObject, iScrewdriver);
}

function oObject0_Interact(Object *theObject, CursorMode mode)
{
  if (!OpeningStuck) 
  { 
    cArin.Say("Who helped me out of there?");
    return; 
  }
  if (player.ScriptName == "cArin") 
  {
    player.Say("I'm stuck!");
    player.Say("I don't think I'll be able to push this off on my own.");
  }
  else {
    player.Walk(115, 180, eBlock);
    theObject.TweenY(2.5, theObject.Y + 20);
    OpeningStuck = false;
    RestoreWalkableArea(1);
    cArin.SetAsPlayer();
    cArin.Say("Hey, thanks.");
    cArin.UnlockView();
    Wait(20);
    cArin.Say("Who are you?");
    cShadow.Say("...");
    cArin.Say("What are you?");
    Wait(100);
    TintScreen(1, 1, 1);
    cShadow.on = 0;
    IndependentShadow = false;
    cArin.Say("Hello?");
    cArin.Say("Where did he go?");
    cArin.Say("Well there goes the lights.");
    cArin.Say("Maybe I can get the lights back on?");
  }
}

function oDoorControl_UseInv(Object *theObject, CursorMode mode)
{
  if (player.ActiveInventory == iScrewdriver) {
    player.Walk(295, 150, eBlock);
    player.ChangeRoom(2);
    cArin.on = 0;
  }
}

function hDoorRight_MouseMove(Hotspot *theHotspot)
{
  mouse.Mode = eModeDoor;
}


function hDoorRight_AnyClick(Hotspot *theHotspot, CursorMode mode)
{
  if (OpeningStuck) {
    player.Say("That's the door out of here.");
    player.Say("I would leave through it if I weren't under this debris.");
    return;
  }
  player.Walk(295, 150, eBlock);
  if (DoorRepaired)
  {
    player.ChangeRoom(3);
  }
  else
  {
    player.Say("Stuck shut?");
    player.Say("Looks like the controller's gone bad.");
  }
  
}

function oDoorControl_Look(Object *theObject, CursorMode mode)
{
  player.Say("That's the door control panel.");
  if (DoorRepaired)
  {
    player.Say("It should be functioning now.");
  }
  else
  {
    player.Say("Looks shot. If I had a screwdriver I could take a look inside.");
  }
}

function oDoorControl_Talk(Object *theObject, CursorMode mode)
{
  player.Say("It's not that advanced!");
  if (!DoorRepaired)
  {
    player.Say("Besides, looks broken anyhow.");
  }
}

function oDoorControl_Interact(Object *theObject, CursorMode mode)
{
  player.Say("Can't get into that without a screwdriver.");
}
